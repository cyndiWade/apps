<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<include file="Header:top" />
<style>
.btn{
	float:right;
	margin:-4px 40px 0 0;
}
.subcompanys {
	margin:20px 0 0 90px;
}
.subcompanys li {
	list-style-type:none;
}
.needStart {
	color:red;
}
.selectWidth {
	width:105px;
}
.p_style {
	margin:0 0 0 63px;
}
#add {
	float:left;
}


</style>
</head>
<body>
	
<include file="Header:header" />
<include file="Header:left" />

        <!--Body content-->
        <div id="content" class="clearfix">
            <div class="contentwrapper"><!--Content wrapper-->

                <div class="heading">

                    <h3>公司信息</h3>                    

                    <div class="resBtnSearch">
                        <a href="#"><span class="icon16 icomoon-icon-search-3"></span></a>
                    </div>

                    <div class="search" >

                        <form id="searchform" action="search.html">
                            <input type="text" id="tipue_search_input" class="top-search" placeholder="Search here ..." />
                            <input type="submit" id="tipue_search_button" class="search-btn" value=""/>
                        </form>
                
                    </div><!-- End search -->
                    


                </div><!-- End .heading-->
                    
                <!-- Build page from here: Usual with <div class="row-fluid"></div> -->


                    <div class="row-fluid">

                        <div class="span6">
                            
                            <div class="box">

                               <div class="box">

                                <div class="title">

                                    <h4> 
                                        <span>编辑公司信息</span>
                                    </h4>
                                    
                                </div>
                                <div class="content">
                                   
                                    <form class="form-horizontal" action="" method="post" enctype="multipart/form-data">
                                        
                                        <div class="form-row row-fluid">
                                            <div class="span12">
                                                <div class="row-fluid">
                                                    <label class="form-label span4" for="normal">公司名称</label>
                                                    <input class="span8 text" id="normalInput" type="text" name="name" value="{$data.name}" style="width:400px;">
                                                </div>
                                            </div>
                                        </div>
										<div class="form-row row-fluid">
                                            <div class="span12">
                                                <div class="row-fluid">
                                                    <label class="form-label span4" for="normal">公司LOGO</label>
													<if condition="$data['logo']"><img src="__IMAGES__{$data.logo}" width=160 height=160 /></if>
                                                    <input class="uploader" id="normalInput" type="file" name="logo" >
                                                </div>
                                            </div>
                                        </div>
										<div class="form-row row-fluid">
                                            <div class="span12">
                                                <div class="row-fluid">
                                                    <label class="form-label span4" for="normal">公司简介</label>
                                                    <textarea class="span8 uniform" id="textarea" rows="5" name="info" style="width:400px;">{$data.info}</textarea>
                                                </div>
                                            </div>
                                        </div>
										
										<div class="form-row row-fluid">
                                            <div class="span12">
                                                <div class="row-fluid">
                                                    <label class="form-label span4" for="normal">门店信息</label>
                                                    <table>
                                                    	<tr><td>门店名称</td><td>门店地址</td><td>服务区域</td><td>服务电话</td><td>营业时间</td><td>操作</td></tr>
                                                    	<volist name="subcompanys" id="vo">
														<tr>
                                                    		<td>{$vo.name}</td>
															<td>{$vo.address}</td>
															<td>{$vo.site}</td>
															<td>{$vo.phone}</td>
															<td>{$vo.opentime}</td>
															<td>
																<a href="javascript:;" title="编辑" class="edit" data-id="{$vo.id}" data-area="{$vo.area}"><span class="icon12 icomoon-icon-pencil"></span></a> &nbsp;
																<a href="?s=/App/del/id/{$vo.id}" title="删除" class="del" data-id="{$vo.id}"  onclick="return confirm('确定要删除吗？') ? true : false"><span class="icon12 icomoon-icon-remove"></span></a>
															</td>
                                                    	</tr>
														</volist>
													</table>
                                                </div>
                                            </div>
                                        </div>

										<div class="form-row row-fluid">
                                            <div class="span12">
                                                <div class="row-fluid">
                                                    <label class="form-label span4" for="normal"></label>
													
													<button class="btn edit" id="add" type="button" data-id="0" data-area="0,0">
														<span class="icon16 icomoon-icon-cog"></span>
														添加
													</button>
                                                </div>
                                            </div>
                                        </div>
										
										<div class="form-row row-fluid">
                                            <div class="span12">
                                                <div class="row-fluid">
                                                    <label class="form-label span4" for="normal">联系人</label>
                                                    <input class="span8 text" id="normalInput" type="text" name="contact" value="{$data.contact}" style="width:120px;">
                                                </div>
                                            </div>
                                        </div>
										<div class="form-row row-fluid">
                                            <div class="span12">
                                                <div class="row-fluid">
                                                    <label class="form-label span4" for="normal">联系电话</label>
                                                    <input class="span8 text" id="normalInput" type="text" name="phone" value="{$data.phone}" style="width:120px;">
                                                </div>
                                            </div>
                                        </div>
										
										<div class="form-actions">
                                           <button type="submit" class="btn btn-info">保 存</button>
                                        </div>
                                                                                
                                    </form>
                                 
                                </div>

                            </div>

                            </div><!-- End .box -->

                        </div><!-- End .span6 -->

                    </div><!-- End .row-fluid -->
	

<!-- 对话框 -->
<div class="Popup" title="门店信息" style="display:none;">
	<form method="post"  action="?s=/App/edit" id="subcompanys">
		<input type="hidden" name="id" />
	  <ul class="subcompanys">
	  	<li>门店名称：<span class="needStart">&nbsp;*&nbsp;</span><span><input type="text" name="name" /></span></li>
		<li>店铺地址：&nbsp;&nbsp;&nbsp;
			<span id="area"></span>
			<!-- 
			<select name="region" class="nostyle selectWidth region">
				<option value="-1">请选择</option>
				<option value="2">aa</option>
			</select>
			<select name="location" class="nostyle selectWidth location">
				
			</select>
			-->
			<p class="p_style"><span class="needStart">*&nbsp;</span><input type="text" name="address" /></p>
		</li>
		<li>服务区域：<span class="needStart">&nbsp;*&nbsp;</span><span><input type="text" name="site" /></span></li>
		<li>服务电话：<span class="needStart">&nbsp;*&nbsp;</span><span><input type="text" name="phone" /></span></li>
		<li>营业时间：<span class="needStart">&nbsp;*&nbsp;</span><span><input type="text" name="opentime" /></span></li>
	  </ul>
	   </form>
</div>	          
       
<include file="Footer:bottom" />

<script type="text/javascript">
	
//弹出框
function detailed ($obj) {
	$('.Popup').dialog({
		modal : true,
		buttons:{
			"提交" : function (event) {		
				$obj.submit();
				//$(this).dialog('close');
			},
			"关闭" : function (event) {
				$(this).dialog('close');
			}
		}
	});	
}

//获取对应数据
function getServerInfo($url,$condition) {
	var data;
	$.ajaxSetup({
		async: false		//async:false 同步请求  true为异步请求
	});
	//ajax 请求数据
	$.get($url,$condition,function (obj) {
		data = obj;
	},'text');
	return data;
}
	


$(function () {
	
	//选择操作对象
	var arrEdit = $('.edit');		//编辑
	var arrDel = $('.del');			//删除
	var objAdd = $('#add');		//添加
	var objSpan = $('#area');	//保存地区的id
	var objForm =$('#subcompanys');

	//编辑门店信息
	(function () {
		
		
//		objAdd.click(function () {
//		//	alert(getArea());
//			objSpan.html(getArea());
//			detailed(objForm);								//执行弹出框
//		});
		
		arrEdit.click(function () {
			
			var _this = $(this);
			var id = _this.data('id');
			var area = _this.data('area');
			var arrIpt = objForm.find('input');		//表单中的input
			//获取地址联动菜单
			var arttArea =  area.split(',');

			var areaSelect = getServerInfo('?s=/App/AjaxArea/',{
				'region' :arttArea[0],
				'area' : arttArea[1]
			});
			//获取当前门店详细信息
			eval("var data ="+getServerInfo('?s=/App/edit/',{'id' : id}));			//当前门店相关数据	
			
			objSpan.html(areaSelect);	//添加到节点
			arrIpt.each (function () {
				var _ipt = $(this);
				var value  = data.info[_ipt.attr('name')];
				_ipt.val(value);
				
			});
			
			detailed(objForm);								//执行弹出框
		});

	})();
	
	
});	
</script>

